<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.norm.timemall.app.indicator.mapper.IndVirtualProductMapper">
    <sql id="tableName">
        virtual_product
    </sql>

    <sql id="baseColumn">
        id,product_name,product_price,product_desc,thumbnail_url,inventory,provide_invoice,deliver_note,deliver_attachment,product_status,seller_brand_id,sales_volume,clicks,views,tags,create_at,modified_at
    </sql>

    <update id="updateImpressions" parameterType="com.norm.timemall.app.indicator.domain.dto.IndDataLayerVirtualProductIndicesDTO">
         update virtual_product set views=IFNULL(views,0)+1 where id in
        <foreach collection="dto.virtual.impressions" item="product" separator="," open="(" close=")">
            #{product.productId}
        </foreach>
    </update>

    <update id="updateClicks" parameterType="com.norm.timemall.app.indicator.domain.dto.IndDataLayerVirtualProductIndicesDTO">
        update virtual_product set clicks=IFNULL(clicks,0)+1 where id in
        <foreach collection="dto.virtual.clicks" item="product"  separator="," open="(" close=")">
            #{product.productId}
        </foreach>
    </update>
    <update id="updatePurchase" parameterType="com.norm.timemall.app.indicator.domain.dto.IndDataLayerVirtualProductIndicesDTO">
        update virtual_product set sales_volume=IFNULL(sales_volume,0)+1 where id = #{dto.virtual.purchases.productId}
    </update>

</mapper>