<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.norm.timemall.app.ms.mapper.MsMpsMsgMapper">

    <resultMap id="mpsEventRecordResultMap" type="com.norm.timemall.app.ms.domain.pojo.MsDefaultEventRecord">
        <result property="stampDate" column="stampDate"/>
        <collection property="cards" ofType="com.norm.timemall.app.ms.domain.pojo.MsDefaultEventCard" javaType="ArrayList">
            <result property="author" column="author"/>
            <result property="authorIcon" column="authorIcon"/>
            <result property="authorId" column="author_id"/>
            <result property="createAt" column="create_at"/>
            <result property="msg" column="msg"/>
            <result property="msgType" column="msg_type"/>
        </collection>
    </resultMap>

    <resultMap id="mpsEventResultMap" type="com.norm.timemall.app.ms.domain.pojo.MsDefaultEvent">
        <result property="room" column="target_id"/>
        <collection property="records" ofType="com.norm.timemall.app.ms.domain.pojo.MsDefaultEventRecord" javaType="ArrayList" resultMap="mpsEventRecordResultMap"/>
    </resultMap>

    <select id="selectMpsEventByTargetId" resultMap="mpsEventResultMap">
        select m.target_id,DATE_FORMAT(m.create_at,"%Y-%m-%d") stampDate,b.brand_name author,b.avator authorIcon,m.author_id,m.create_at,m.msg_type,m.msg
        from mps_msg m
        left join brand b
        on b.id = m.author_id
        where m.target_id = #{target_id}
        order by m.create_at
    </select>
</mapper>