<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.norm.timemall.app.ms.mapper.MsMillstoneMsgMapper">


    <resultMap id="millstoneEventRecordResultMap" type="com.norm.timemall.app.ms.domain.pojo.MsMillstoneEventRecord">
        <result property="stampDate" column="stampDate"/>
        <collection property="cards" ofType="com.norm.timemall.app.ms.domain.pojo.MsMillstoneEventCard" javaType="ArrayList">
            <result property="author" column="author"/>
            <result property="authorIcon" column="authorIcon"/>
            <result property="authorId" column="author_id"/>
            <result property="createAt" column="create_at"/>
            <result property="msg" column="msg"/>
            <result property="msgType" column="msg_type"/>
        </collection>
    </resultMap>

    <resultMap id="millstoneEventResultMap" type="com.norm.timemall.app.ms.domain.pojo.MsMillstoneEvent">
        <result property="millstoneId" column="millstoneId"/>
        <collection property="records" ofType="com.norm.timemall.app.ms.domain.pojo.MsMillstoneEventRecord" javaType="ArrayList" resultMap="millstoneEventRecordResultMap"/>
    </resultMap>

    <select id="selectMillstoneEventByMillstoneId" resultMap="millstoneEventResultMap">
        select m.millstone_id millstoneId,DATE_FORMAT(m.create_at,"%Y-%m-%d") stampDate,b.brand_name author,b.avator authorIcon,m.author_id,m.create_at,m.msg_type,m.msg
        from millstone_msg m
        left join brand b
          on b.id = m.author_id
        where m.millstone_id = #{millstone_id}
        order by m.create_at
    </select>

</mapper>