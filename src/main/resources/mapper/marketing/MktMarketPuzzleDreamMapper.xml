<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.norm.timemall.app.marketing.mapper.MktMarketPuzzleDreamMapper">
    <select id="selectDreamListByQ" resultType="com.norm.timemall.app.marketing.domain.ro.MktFetchDreamsRO">
        select d.id,d.od,d.likes,d.content,d.author_brand_id author,b.brand_name authorName,
        (case when l.likes_brand_id is null then '0'
              else '1'
         end) as alreadyLike
        from market_puzzle_dream d
        inner join brand b
          on b.id=d.author_brand_id
        left join market_puzzle_likes l
          on l.dream_id=d.id
        <where>
            1=1
            AND d.event_id=#{puzzle_version}
            <if test="q != null and q != ''">
                AND d.od=#{q}
            </if>
            order by d.likes desc
        </where>
    </select>

</mapper>